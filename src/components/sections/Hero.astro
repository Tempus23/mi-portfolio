---
import cvDataEn from "@/data/cv_data.json";
import cvDataEs from "@/data/cv_data_es.json";
import Badge from "@/components/ui/Badge.astro";
import LinkedInIcon from "@/components/icons/LinkedIn.astro";
import Mail from "@/components/icons/Mail.astro";
import GitHubIcon from "@/components/icons/GitHub.astro";
import SocialPill from "@/components/ui/SocialPill.astro";

// Default to English for server-side rendering
const { basic_info, languages } = cvDataEn;
const personalImageAlt = basic_info.personal_image_alt;
---

<div class="max-w-xl">
  <div class="flex gap-4 mb-4 items-center animate-fade-in">
    <img
      class="rounded-full shadow-lg size-24 ring-4 ring-gray-200 dark:ring-gray-700 hover:scale-105 transition-transform duration-300"
      src={`/${basic_info.image_path}`}
      alt={personalImageAlt}
    />
    <div>
      <h1
        class="text-4xl font-bold tracking-tight text-gray-800 sm:text-5xl dark:text-white mb-6"
      >
        <span data-i18n="hero.greeting">Hey, I'm</span> <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-violet-600 dark:from-blue-400 dark:to-violet-400"
          >{basic_info.name.split(" ")[0]}</span
        >
      </h1>
      <Badge class="inline-block animate-pulse-slow" data-availability
        >{basic_info.availability}</Badge
      >
    </div>
  </div>
  <p
    class="mt-6 text-xl text-gray-800 dark:[&>strong]:text-yellow-200 [&>strong]:text-yellow-500 [&>strong]:font-semibold dark:text-gray-300 leading-relaxed"
    data-tagline
  />
  <div class="flex flex-wrap gap-2 mt-6" id="languages-list">
    {
      languages.map((language) => (
        <Badge class="bg-blue-50 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200 border border-blue-200 dark:border-blue-700" data-lang-badge>
          {language.name} · {language.level}
        </Badge>
      ))
    }
  </div>

  <nav class="flex flex-wrap gap-4 mt-8">
    <SocialPill href={`mailto:${basic_info.emails[0]}`}>
      <Mail class="size-4" />
      <span data-i18n="hero.contactMe">Contact Me</span>
    </SocialPill>
    <SocialPill href={basic_info.linkedin}>
      <LinkedInIcon class="size-4" />
      LinkedIn
    </SocialPill>
    <SocialPill href={basic_info.github}>
      <GitHubIcon class="size-4" />
      GitHub
    </SocialPill>
  </nav>
</div>

<script define:vars={{ cvDataEn, cvDataEs }}>
  import { getLanguage } from '@/utils/languageStore';

  function updateHeroContent() {
    const lang = getLanguage();
    const cvData = lang === 'es' ? cvDataEs : cvDataEn;
    const { basic_info, languages } = cvData;

    // Update availability
    const availEl = document.querySelector('[data-availability]');
    if (availEl) availEl.textContent = basic_info.availability;

    // Update tagline
    const taglineEl = document.querySelector('[data-tagline]');
    if (taglineEl) {
      let tagline = basic_info.tagline;
      tagline = tagline.replace(
        /(Artificial Intelligence|Inteligencia Artificial)/gi,
        '<strong>$1</strong>'
      );
      tagline = tagline.replace(
        /(Backend Development|Backend)/gi,
        '<strong>$1</strong>'
      );
      taglineEl.innerHTML = tagline;
    }

    // Update languages
    const langList = document.getElementById('languages-list');
    if (langList) {
      langList.innerHTML = languages.map(language => 
        `<span class="bg-blue-50 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200 border border-blue-200 dark:border-blue-700 py-1 px-2 rounded-lg text-sm" data-lang-badge>${language.name} · ${language.level}</span>`
      ).join('');
    }
  }

  document.addEventListener('astro:page-load', updateHeroContent);
  window.addEventListener('languagechange', updateHeroContent);
</script>
